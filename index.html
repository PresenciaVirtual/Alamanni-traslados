<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta nombre="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alamanni Traslados</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        input, button {
            display: block;
            width: 90%;
            margin-bottom: 10px;
            padding: 10px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            background: #e9ecef;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
    <link rel="icon" type="image/png" href="https://via.placeholder.com/16x16.png?text=A">
</head>
<body>

<div class="container">
    <h1>Agregar y Eliminar Pasajeros</h1>
    <form id="userForm">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="clave" placeholder="CLAVE (siempre en minuscula, ej: a1 mva011)" required>
        <input type="text" id="dni" placeholder="Dni" required>
        <button type="submit">Agregar/Actualizar</button>
    </form>

    <h2>Desactivar Pasajero (Por ahora no tocar)</h2>
    <form id="deleteForm">
        <input type="text" id="deleteClave" placeholder="CLAVE para desactivar" required>
        <button type="submit">Desactivar</button>
    </form>

    <h2>Lista de Pasajeros</h2>
    <ul id="userList"></ul>
</div>

<script type="module">
  // Importa las funciones de Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDr8zY0fJoppe4b-RWItFvWiGWW_tgYvO4",
    authDomain: "alamanni-traslados-fa9c5.firebaseapp.com",
    projectId: "alamanni-traslados-fa9c5",
    storageBucket: "alamanni-traslados-fa9c5.appspot.com",
    messagingSenderId: "119290167074",
    appId: "1:119290167074:web:5a8e5ae83e97f74e7cef7b",
    measurementId: "G-5QWZD0F4PK"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Referencias a los formularios y la lista de usuarios
  const userForm = document.getElementById('userForm');
  const deleteForm = document.getElementById('deleteForm');
  const userList = document.getElementById('userList');

  // Agregar o actualizar usuario
  userForm.addEventListener('submit', function(e) {
      e.preventDefault();

      const nombre = document.getElementById('nombre').value;
      const clave = document.getElementById('clave').value;
      const dni = document.getElementById('dni').value;

      if (clave) {
          set(ref(db, 'users/' + clave), {
              nombre: nombre,
              clave: clave,
              dni: dni,
              active: true  // El usuario está activo
          }).then(() => {
              alert('Usuario agregado/actualizado');
              userForm.reset();
              loadUsers();
          }).catch(error => {
              console.error('Error al agregar/actualizar usuario:', error);
          });
      }
  });

  // Desactivar usuario por CLAVE
  deleteForm.addEventListener('submit', function(e) {
      e.preventDefault();

      const deleteClave = document.getElementById('deleteClave').value;

      if (deleteClave) {
          set(ref(db, 'users/' + deleteClave + '/active'), false)  // Se cambia el estado a inactivo
              .then(() => {
                  alert('Usuario desactivado');
                  deleteForm.reset();
                  loadUsers();
              })
              .catch(error => {
                  console.error('Error al desactivar usuario:', error);
              });
      }
  });

  // Cargar y mostrar usuarios
  function loadUsers() {
      const usersRef = ref(db, 'users');
      onValue(usersRef, snapshot => {
          const users = snapshot.val();
          userList.innerHTML = '';
          for (const clave in users) {
              if (users[clave].active) {  // Solo se muestra usuarios activos
                  const li = document.createElement('li');
                  li.textContent = `Nombre: ${users[clave].nombre}, Clave: ${users[clave].clave}, Dni: ${users[clave].dni}`;
                  userList.appendChild(li);
              }
          }
      });
  }

  // Se cargan los usuarios
  loadUsers();
</script>

</body>
</html>
