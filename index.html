<!DOCTYPE html>
<html>
<head>
  <title>Firebase QR Code App</title>
</head>
<body>
  <!-- Canvas para generar el código QR -->
  <canvas id="qrCodeCanvas"></canvas>
  <div id="userInfo"></div>

  <!-- Firebase scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Configuración de Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyDlL3r5WRpnQaQO-2lzapM1u-TdpNJtRGE",
        authDomain: "alamanni-traslados.firebaseapp.com",
        projectId: "alamanni-traslados",
        storageBucket: "alamanni-traslados.appspot.com",
        messagingSenderId: "55093809134",
        appId: "1:55093809134:web:0c87c40e703ec1dd2d88ff",
        measurementId: "G-05WY4C1V32"
      };

      // Inicializar Firebase
      firebase.initializeApp(firebaseConfig);

      // Referencia a la base de datos de Firebase
      const database = firebase.database();

      // Ejemplo de cómo guardar un nuevo usuario
      const userId = 12345;  // Esto lo obtendrás dinámicamente
      const userData = {
        name: 'John Doe',
        email: 'john@example.com'
      };

      // Guardar la información del usuario en Firebase Realtime Database
      database.ref('users/' + userId).set(userData)
        .then(() => {
          // Generar el código QR con la URL que contiene el userId
          const qrData = `https://alamanni-traslados.firebaseapp.com/user/${userId}`;
          const qrCodeCanvas = document.getElementById('qrCodeCanvas');
          QRCode.toCanvas(qrCodeCanvas, qrData, function (error) {
            if (error) console.error(error);
            console.log('Código QR generado con URL:', qrData);
          });
        })
        .catch((error) => {
          console.error('Error guardando la información: ', error);
        });

      // Obtener la información de un usuario al escanear el QR
      const userInfo = document.getElementById('userInfo');
      database.ref('users/' + userId).once('value')
        .then((snapshot) => {
          const data = snapshot.val();
          if (data) {
            userInfo.innerText = `Nombre: ${data.name}, Email: ${data.email}`;
          } else {
            userInfo.innerText = 'Usuario no encontrado.';
          }
        })
        .catch((error) => {
          console.error('Error obteniendo la información del usuario: ', error);
        });
    });
  </script>
</body>
</html>
